<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Octopress | ni-blog]]></title>
  <link href="http://orihubon.com/blog/categories/octopress/atom.xml" rel="self"/>
  <link href="http://orihubon.com/"/>
  <updated>2015-04-19T12:59:58+09:00</updated>
  <id>http://orihubon.com/</id>
  <author>
    <name><![CDATA[niku4i]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[OctopressのソースリポジトリをDropboxに変更]]></title>
    <link href="http://orihubon.com/blog/2012/03/18/change-upstream-of-source-to-dropbox/"/>
    <updated>2012-03-18T05:32:00+09:00</updated>
    <id>http://orihubon.com/blog/2012/03/18/change-upstream-of-source-to-dropbox</id>
    <content type="html"><![CDATA[<p>OctopressのソースコードをDropboxに変更した。</p>

<!--more-->


<h3>octopressのソースファイルの管理</h3>

<p><a href="http://octopress.org/docs/deploying/github/">Deploying to Github Pages</a>の手順でgithub pagesを使うと、localのworking copyにはsourceというブランチが生成されています。blogを書くときは以下のワークフローになるようです。</p>

<ol>
<li><code>rake new_post['hoge']</code>で記事を作成</li>
<li><code>rake deploy</code>で記事を公開</li>
<li><code>git push</code>にてlocalのsourceブランチをgithub.comにpush(sourceファイルのバックアップ)</li>
</ol>


<p><code>git push</code>してupstreamにpushするとgithub上に全部公開されますが、個人的にはソースファイルは公開しなくてよいなと考えました。plugin作って見せたりするシーンでは便利ですが今のところgistを使えば十分なので。</p>

<p>そこで<code>git push</code>する先のリポジトリをgithub.comからDropboxに作成したリモートリポジトリに変更してみます。</p>

<h3>リポジトリ作成</h3>

<pre><code>mkdir -p ~/Dropbox/repos/ni-blog.git        
cd ~/Dropbox/repos/ni-blog.git              
git --bare init                           
</code></pre>

<h3>リモートリポジトリの追加</h3>

<p>リモートリポジトリの確認
現在のremoteはoctopressとoriginの2種類。</p>

<pre><code>$ cd path/to/octopress
$ git remote -v                     
octopress       git://github.com/imathis/octopress.git (fetch)
octopress       git://github.com/imathis/octopress.git (push)
origin  git@github.com:niku4i/niku4i.github.com.git (fetch) 
origin  git@github.com:niku4i/niku4i.github.com.git (push)  
</code></pre>

<p>~/Dropbox/repos/ni-blog.gitをdropboxという名前で登録</p>

<pre><code>git remote add dropbox ~/Dropbox/repos/ni-blog.git
</code></pre>

<p>確認</p>

<pre><code>$ git remote -v                          
dropbox /Users/nikushi/Dropbox/repos/ni-blog.git (fetch)       
dropbox /Users/nikushi/Dropbox/repos/ni-blog.git (push)        
octopress       git://github.com/imathis/octopress.git (fetch) 
octopress       git://github.com/imathis/octopress.git (push)  
origin  git@github.com:niku4i/niku4i.github.com.git (fetch)    
origin  git@github.com:niku4i/niku4i.github.com.git (push)     
</code></pre>

<p>dropboxが追加されました。</p>

<h3>Dropboxのリポジトリにソースファイルをpushする</h3>

<p>まずbareで作成したDropboxのリポジトリにpush。-uを指定することで以降<code>git push</code>(引数なし)で実行可能になります。最初の1回だけ-uつきで実行します。</p>

<pre><code>$ git push -u dropbox source                   
Counting objects: 4110, done.                                        
Delta compression using up to 4 threads.                             
Compressing objects: 100% (1598/1598), done.                         
Writing objects: 100% (4110/4110), 2.73 MiB, done.                   
Total 4110 (delta 2307), reused 3836 (delta 2197)                    
To /Users/nikushi/Dropbox/repos/ni-blog.git                          
 * [new branch]      source -&gt; source                                
 Branch source set up to track remote branch source from dropbox.     
</code></pre>

<p>以後<code>git push</code>を実行するとDropboxのリポジトリにバックアップされることになります。</p>

<h3>バックアップからリカバリする</h3>

<p>本当にバックアップされたか確認してみます。<code>git clone</code>する際には-bでsourceブランチを指定する必要がありました。</p>

<pre><code>mkdir ~/tmp/ &amp;&amp; cd ~/tmp/
git clone -b source ~/Dropbox/repos/ni-blog.git
cd ni-blog
</code></pre>

<p>この状態では、remoteはorigin=~/Dropbox/repos/ni-blog.gitのみがリモートリポジトリに設定されていますので、元々の設定に戻してあげます。現在のremoteの設定は<code>git remote -v</code>で確認してください。</p>

<pre><code>git remote add octopress  git://github.com/imathis/octopress.git 
git remote rename origin dropbox
git remote add origin  git@github.com:niku4i/niku4i.github.com.git
git push -u dropbox source                   
</code></pre>

<p>3つのremoteを設定し、dropboxリモートリポジトリをgit pushのデフォルトにしました。</p>

<p>rake deployにてgithubに記事をアップロード、git pushにてDropboxにバックアップするワークフローに変更しましたのでしばらく運用してみます。</p>

<p><strong>2012/11/05 追記</strong>
最終的には、github.comをremoteにする運用に戻しました。</p>

<pre><code>git push -u origin source
</code></pre>
]]></content>
  </entry>
  
</feed>
