<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ruby | ni-blog]]></title>
  <link href="http://orihubon.com/blog/categories/ruby/atom.xml" rel="self"/>
  <link href="http://orihubon.com/"/>
  <updated>2012-04-09T02:09:11+09:00</updated>
  <id>http://orihubon.com/</id>
  <author>
    <name><![CDATA[niku4i]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[TEDの英文を取得する]]></title>
    <link href="http://orihubon.com/blog/2012/04/09/fetch-subtitle-for-talks-in-ted/"/>
    <updated>2012-04-09T01:49:00+09:00</updated>
    <id>http://orihubon.com/blog/2012/04/09/fetch-subtitle-for-talks-in-ted</id>
    <content type="html"><![CDATA[<p>通勤電車の中でひたすらTEDのすばらしいトークを聞いて暗記したかったので英文をテキストで取得できないかと調べてみたら簡単に取得できるようです。</p>

<p>Rubyで取得するコードを書いてみました。</p>

<!-- more -->


<p>URLを叩くとJSONで返してくれるのでparseしてputsするだけでした。</p>

<p><div><script src='https://gist.github.com/2338391.js?file='></script>
<noscript><pre><code>#!/usr/bin/env ruby

#
# Dump subtitle in text for TED
#

require 'json'
require 'open-uri'

base_url = 'http://www.ted.com/talks/subtitles'
id = 1183
url = &quot;#{base_url}/id/#{id.to_s}/lang/eng&quot;

data = JSON.parse(open(url).read)
if data &amp;&amp; data.key?('captions')
  data['captions'].each do |sentence|
    puts sentence['content']
    puts 
  end
end 
</code></pre></noscript></div>
</p>

<p><a href="http://www.ted.com/talks/matt_cutts_try_something_new_for_30_days.html">Matt Cutts: Try something new for 30 days</a> という有名なTEDのトークをひとまずdumpしてみました。</p>

<p>```
$ ./teddump.rb
A few years ago,</p>

<p>I felt like I was stuck in a rut,</p>

<p>so I decided to follow in the footsteps</p>

<p>of the great American philosopher, Morgan Spurlock,</p>

<p>and try something new for 30 days.</p>

<p>The idea is actually pretty simple.</p>

<p>Think about something you've always wanted to add to your life</p>

<p>and try it for the next 30 days.</p>

<p>It turns out,</p>

<p>30 days is just about the right amount of time
```</p>

<p>できた!</p>

<p>以下を参考にしました。
- <a href="http://stackoverflow.com/questions/1955618/parsing-and-converting-ted-talks-json-subtitles">Parsing and Converting TED Talks JSON Subtitles</a>
- <a href="http://d.hatena.ne.jp/meganii/20120320/1332214416">TEDの英語原稿を取得する - ギークを夢見るじょーぶん男子 </a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Installing rvm and Ruby1.9.3/1.9.2 on LLVM gcc and XCode4.3.1]]></title>
    <link href="http://orihubon.com/blog/2012/03/15/install-rvm-and-ruby193-and-192-on-llvm-gcc-and-xcode431/"/>
    <updated>2012-03-15T00:30:00+09:00</updated>
    <id>http://orihubon.com/blog/2012/03/15/install-rvm-and-ruby193-and-192-on-llvm-gcc-and-xcode431</id>
    <content type="html"><![CDATA[<p>XCode 4.3.1 + rvm + Ruby1.9.3-p125の組み合わせでRubyをbuildする。</p>

<p>Mac Book Air(2011 mid)購入直後はrbenvを使っていたが結局rvmに戻すことにしたのが始まり。rvmでRubyが動くようになるまでとても苦労したので記しておく。</p>

<p>普通に考えて進めると、</p>

<ol>
<li>XCodeインストール</li>
<li>rvm install</li>
</ol>


<p>するのだけど、</p>

<p><code>
The provided compiler '/usr/bin/gcc' is LLVM based, it is not yet fully supported by ruby and gems, please read `rvm requirements`.
</code>
という出力で終了する。ネット上の情報を見ると<a href="https://github.com/kennethreitz/osx-gcc-installer/downloads">osx-gcc-installer</a>をインストールする例と、LLVMではないgccが入ってるXCode 4.1にダウングレードする方法と、4.2以降を使って--with-gcc=clangをつけてインストールする方法があった。今回は--with-gcc=clangをつけてRubyをbuildした。詳細は後述。</p>

<p>以下、詳細。</p>

<!-- more -->


<h3>環境</h3>

<ul>
<li>Mac OS X Version 10.7.3 Lion</li>
<li>XCode 4.3.1</li>
<li>gcc version 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2336.9.00)</li>
<li>rvm 1.10.3</li>
<li>rvm installするRuby

<ul>
<li>ruby-1.9.2-p318</li>
<li>ruby-1.9.3-p125</li>
</ul>
</li>
</ul>


<p>このブログ=octopressが現時点で1.9.3に対応していないため、1.9.2-p318もインストールした。</p>

<h3>rbenvをアンインストール</h3>

<p><code>
$ rm -rf ~/.rbenv
</code></p>

<h3>rvmをインストール</h3>

<p>公式ページの手順どおりやればよし。あえてコマンドは書かない。</p>

<h3>XCode</h3>

<p>XCode4.3からXCode本体とは別パッケージでgccやmake等のCLIツールだけのCommand Line Tools for XcodeというパッケージがApp Storeから入手できるようになった。</p>

<p>Mac Book Airの容量を節約できるしXCodeのCLIツールしか使わないのでこれは嬉しいので、喜んでXCodeはインストールせずCommand Line Tools for Xcodeだけインストールして、rvm install ... と進めていたのだけど、最終的にやはり必要ということが分かった。</p>

<p>XCodeが結局必要な理由は話が先に飛ぶが、<code>rvm install ruby-1.9.2</code>の後octopress(このブログのシステム)用のgemをインストールする目的で<code>bundle install</code>する必要があったが、以下のとおりXCodeが見つからないというエラーが出てしまう。
<code>``
$ rake new_post['rbenvからrvmに変更した']
Could not find RedCloth-4.2.8 in any of the sources
Run</code>bundle install<code>to install missing gems.
mba208:octopress nikushi$ bundle install
Fetching gem metadata from http://rubygems.org/.......
Using rake (0.9.2)
Installing RedCloth (4.2.8) with native extensions
Installing posix-spawn (0.3.6) with native extensions
Installing albino (1.3.3)
Installing blankslate (2.1.2.4)
Installing chunky_png (1.2.1)
Installing fast-stemmer (1.0.0) with native extensions
Installing classifier (1.3.3)
Installing fssm (0.2.7)
Installing sass (3.1.5)
Installing compass (0.11.5)
Installing directory_watcher (1.4.0)
Installing ffi (1.0.9) with native extensions
Installing haml (3.1.2)
Installing kramdown (0.13.3)
Installing liquid (2.2.2)
Installing syntax (1.0.0)
Installing maruku (0.6.0)
Installing jekyll (0.11.0)
Installing rubypython (0.5.1)
Installing pygments.rb (0.1.3)
Installing rack (1.3.2)
Installing rb-fsevent (0.4.3.1) with native extensions Unfortunately, a fatal error has occurred. Please report this error to the Bundler issue tracker at https://github.com/carlhuda/bundler/issues so that we can fix it. Thanks!
/Users/nikushi/.rvm/rubies/ruby-1.9.2-p318/lib/ruby/site_ruby/1.9.1/rubygems/installer.rb:552:in</code>rescue in block in build_extensions': ERROR: Failed to build gem native extension. (Gem::Installer::ExtensionBuildError)</p>

<pre><code>    /Users/nikushi/.rvm/rubies/ruby-1.9.2-p318/bin/ruby extconf.rb
    creating Makefile
    xcode-select: Error: No Xcode folder is set. Run xcode-select -switch &lt;xcode_folder_path&gt; to set the path to the Xcode folder.
    extconf.rb:15:in `&lt;main&gt;': Could not find a suitable Xcode installation (RuntimeError)
</code></pre>

<p>```</p>

<p>そういうわけでXCode4.3.1をインストール。App Storeからダウンロードする。Command Line ToolはApp Storeからインストールしてもいいし、XCode起動後にPreferenceの中からでもinstall可能。どちらでもよいみたい。</p>

<p>xcode-selectコマンドでpathを確認して、セットされていないようなら-switchでセットする。XCode4.2系は/Developerだったのが4.3系からは/Application/Xcode.app/以下に変更になったらしい。
<code>
$ xcode-select  -print-path
xcode-select: Error: No Xcode folder is set. Run xcode-select -switch &lt;xcode_folder_path&gt; to set the path to the Xcode folder.
</code></p>

<p>手動でセットする
<code>
$ sudo xcode-select -switch /Applications/Xcode.app/Contents/Developer
$ xcode-select  -print-path
/Applications/Xcode.app/Contents/Developer
</code></p>

<h4>Command Line Toolsの確認</h4>

<p><code>
$ ls /Applications/Xcode.app/Contents/Developer/usr/bin/
BuildStrings*                     gcc@                              mksdk*
CpMac*                            gcov@                             momc*
DeRez*                            gcov-4.2@                         nasm*
GetFileInfo*                      gdb*                              ndisasm*
ImageUnitAnalyzer*                git*                              nm*
MergePef*                         git-cvsserver*                    nmedit*
MvMac*                            git-receive-pack@                 opendiff*
PPCExplain*                       git-shell*                        otool*
ResMerger*                        git-upload-archive@               pagestuff*
Rez*                              git-upload-pack*                  projectInfo*
RezDet*                           gitk*                             ranlib@
RezWack*                          gnumake*                          rcs*
SetFile*                          gprof*                            rcs2log@
SplitForks*                       hdxml2manxml*                     rcsclean*
UnRezWack*                        headerdoc2html*                   rcsdiff*
agvtool*                          i686-apple-darwin11-llvm-g++-4.2@ rcsmerge*
amlint*                           i686-apple-darwin11-llvm-gcc-4.2@ rebase*
ar*                               ibtool*                           redo_prebinding*
as*                               ibtool3*                          resolveLinks*
c89*                              ibtoold*                          rlog*
c99*                              ident*                            sdef*
ci*                               install_name_tool*                sdp*
cmpdylib*                         instruments*                      segedit*
co*                               iprofiler*                        size*
codesign_allocate*                javaconfig*                       strip*
codesign_wrapper*                 javatool*                         svn*
cpp*                              ld*                               svnadmin*
ctf_insert*                       ld_classic*                       svndumpfilter*
cvs*                              libtool*                          svnlook*
cvsbug*                           lldb*                             svnserve*
desdp*                            llvm-cpp-4.2@                     svnsync*
docsetutil*                       llvm-g++@                         svnversion*
dsymutil*                         llvm-g++-4.2@                     unwinddump*
dvtexec*                          llvm-gcc@                         xcodebuild*
dwarfdump*                        llvm-gcc-4.2@                     xcrun*
dyldinfo*                         make*                             xed*
g++@                              mapc*                             xml2man*
gatherheaderdoc*                  merge*
</code>
いろいろ入った。
ちなみに、 /usr/bin/以下にもgcc入ったけど競合しないのか?ネット上の情報をみると/Applicaitons/Xcode.app/Contents/Developer/usr/bin/は$PATHに通す必要はないらしい。まったく自信はない。</p>

<p>/usr/bin/gcc -v
<code>
$ /usr/bin/gcc -v
Using built-in specs.
Target: i686-apple-darwin11
Configured with: /private/var/tmp/llvmgcc42/llvmgcc42-2336.9~22/src/configure --disable-checking --enable-werror --prefix=/Applications/Xcode.app/Contents/Developer/usr/llvm-gcc-4.2 --mandir=/share/man --enable-languages=c,objc,c++,obj-c++ --program-prefix=llvm- --program-transform-name=/^[cg][^.-]*$/s/$/-4.2/ --with-slibdir=/usr/lib --build=i686-apple-darwin11 --enable-llvm=/private/var/tmp/llvmgcc42/llvmgcc42-2336.9~22/dst-llvmCore/Developer/usr/local --program-prefix=i686-apple-darwin11- --host=x86_64-apple-darwin11 --target=i686-apple-darwin11 --with-gxx-include-dir=/usr/include/c++/4.2.1
Thread model: posix
gcc version 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2336.9.00)
</code>
/Applications/Xcode.app/Contents/Developer/usr/bin/gcc -v
<code>
$ /Applications/Xcode.app/Contents/Developer/usr/bin/gcc -v
Using built-in specs.
Target: i686-apple-darwin11
Configured with: /private/var/tmp/llvmgcc42/llvmgcc42-2336.9~22/src/configure --disable-checking --enable-werror --prefix=/Applications/Xcode.app/Contents/Developer/usr/llvm-gcc-4.2 --mandir=/share/man --enable-languages=c,objc,c++,obj-c++ --program-prefix=llvm- --program-transform-name=/^[cg][^.-]*$/s/$/-4.2/ --with-slibdir=/usr/lib --build=i686-apple-darwin11 --enable-llvm=/private/var/tmp/llvmgcc42/llvmgcc42-2336.9~22/dst-llvmCore/Developer/usr/local --program-prefix=i686-apple-darwin11- --host=x86_64-apple-darwin11 --target=i686-apple-darwin11 --with-gxx-include-dir=/usr/include/c++/4.2.1
Thread model: posix
gcc version 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2336.9.00)
</code>
同じgccなので気にしないで進む。</p>

<h3>Compiling Ruby</h3>

<p>依存性のあるzlib、openssl、ncurses等を$HOME/.rvm/usr/以下にインストールしとく。zlibが入ってないとインストール後のgemの実行で失敗したので。
<code>
rvm pkg install ree_dependencies
</code></p>

<p>Rubyをインストール
<code>
$ rvm install 1.9.2 --with-gcc=clang
$ rvm install 1.9.3 --with-gcc=clang
</code>
--with-gcc=clangはLLVM gcc対応のため。毎回つけるの面倒くさいな。rvm側の今後のバージョンアップで改善されないかなと期待。</p>

<p><code>
Install of ruby-1.9.2-p318 - #complete
clang: error: unsupported option '--with-libyaml'
Ruby 'ruby-1.9.2-p318' was build using clang - but it's not (fully) supported, expect errors.
</code>
成功するけど--with-libyamlはサポートしてないという警告がでた。とっても気になるのだけどとりあえず気にせず先に進めることにする。問題でないという自信はまったくない。</p>

<p>デフォルトは1.9.3に。
<code>
$ rvm use 1.9.3-p125 --default
$ ruby -v
ruby 1.9.3p125 (2012-02-16 revision 34643) [x86_64-darwin11.3.0]
</code></p>

<p><code>
$ irb
1.9.3p125 :001 &gt; "Enjoy Ruby with rvm"
 =&gt; "Enjoy Ruby with rvm"
</code></p>
]]></content>
  </entry>
  
</feed>
